from pymongo import MongoClient
from termcolor import colored

def get_db_data():
    connection = MongoClient('localhost', 27017)
    db = connection.user2
    data = db.profile2
    data_set = data.find()
    return data_set


def remake_data():
    data_list = get_db_data()
    for record in data_list:
        id_dict = record['id']['id']
        name_dict = record['name']['name']
        posts = record["posts"]
        profile_picture_id = record["profile_picture"]["id"]
        profile_picture_url = record["profile_picture"]["picture"]["data"]["url"]

        photo_array = []
        for x in posts:
            post_id = x["id"]
            if 'full_picture'in x:
                full_picture = x["full_picture"]
            if 'from' in x:
                posted_by = x["from"]["name"]

            photo_array.append(full_picture)

        retrieved_data = {
            "id": id_dict,
            "name": name_dict,
            "photos": photo_array,
            "profile_picture_id": profile_picture_id,
            "profile_picture_url": profile_picture_url

            }

        print(colored('ID name and photos uploaded', 'blue'))
        print(retrieved_data)

        profile = retrieved_data
        print(type(profile))
        client = MongoClient('mongodb://localhost:27017')
        db = client.user2  # new database user2  created
        idPost = db.IdAndPhotos  # collection IdAndPhotos created
        result = idPost.insert_one(profile)


if __name__ == "__main__":
    get_db_data()
    remake_data()
    # create_db()
